# ๐ ุชุนูููุงุช Custom Authentication

## โ ูุง ุชู
ุชู ุชุทููุฑ ูุธุงู ุชุณุฌูู ุฏุฎูู ูุฎุตุต ูุณุชุฎุฏู **username + password ููุท** (ุจุฏูู ุฅูููู ููุงุฆูุงู!)

---

## ๐ ุฎุทูุงุช ุงูุชูุนูู

### 1๏ธโฃ ูููุฐ SQL Setup ูู Supabase

ุฑูุญ ุฅูู **Supabase Dashboard** โ **SQL Editor** โ **New Query**

ูููุฐ ุงูููุฏ ูู ุงูููู: `/supabase-custom-auth-setup.sql`

ูุฐุง ุงูููุฏ ุฑุงุญ:
- โ ููุดุฆ ุฌุฏูู `users` ูุน `password_hash`
- โ ููุดุฆ ุฌุฏูู `user_sessions` ููู tokens
- โ ููุดุฆ 4 ุฏูุงู PostgreSQL:
  - `register_user()` - ูุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ
  - `login_user()` - ูุชุณุฌูู ุงูุฏุฎูู
  - `validate_session()` - ููุชุญูู ูู token
  - `logout_user()` - ูุชุณุฌูู ุงูุฎุฑูุฌ
- โ ููุดุฆ ุจุงูู ุงูุฌุฏุงูู (prayers, athkar, quran_readings, activities)

---

### 2๏ธโฃ ุงูุณุญ localStorage

ุงูุชุญ Developer Console ูู ุงููุชุตูุญ ูุงูุชุจ:

```javascript
localStorage.clear()
```

---

### 3๏ธโฃ ุฌุฑูุจ ุงูุชุทุจูู! ๐

1. ุณุฌูู ุญุณุงุจ ุฌุฏูุฏ:
   - โ ุงูุงุณู ุงููุงูู
   - โ ุงุณู ุงููุณุชุฎุฏู (3 ุฃุญุฑู ุนูู ุงูุฃูู)
   - โ ูููุฉ ุงููุฑูุฑ (6 ุฃุญุฑู ุนูู ุงูุฃูู)

2. ุณุฌูู ุฎุฑูุฌ

3. ุณุฌูู ุฏุฎูู ูุฑุฉ ุซุงููุฉ

4. **ุงูุชุญ ุงูุชุทุจูู ูู ุฌูุงุฒ ุซุงูู** - ูุงุฒู ูุดุชุบู! โ

---

## ๐ ููู ูุดุชุบู ุงููุธุงูุ

### ุนูุฏ ุงูุชุณุฌูู (Register):
1. ุงููุณุชุฎุฏู ูุฏุฎู: username, password, name
2. ุงูู password ููุดูููุฑ ุจู `bcrypt` ูู PostgreSQL
3. ูุชู ุฅูุดุงุก `user_id` ู `partner_code`
4. ูุชู ุฅูุดุงุก `session token` ูุญูุธู ูู ุฌุฏูู `user_sessions`
5. ุงูู token ููุญูุธ ูู `localStorage`

### ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู (Login):
1. ุงููุณุชุฎุฏู ูุฏุฎู: username, password
2. PostgreSQL ูุชุญูู ูู username ูููุงุฑู password hash
3. ุฅุฐุง ุตุญูุญุ ููุดุฆ session token ุฌุฏูุฏ
4. ุงูู token ููุญูุธ ูู localStorage

### ุนูุฏ ูุชุญ ุงูุชุทุจูู:
1. ุงูุชุทุจูู ููุฑุฃ token ูู localStorage
2. ูุณุชุฏุนู `validate_session()` ููุชุญูู ูู ุตุญุฉ token
3. ุฅุฐุง ุตุญูุญุ ููุฑุฌุน ุจูุงูุงุช ุงููุณุชุฎุฏู
4. ุฅุฐุง ููุชูู ุงูุตูุงุญูุฉุ ูุทูุจ login ูู ุฌุฏูุฏ

### ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ:
1. ูุญุฐู token ูู ุฌุฏูู `user_sessions`
2. ููุณุญ localStorage

---

## ๐ ุงูุฃูุงู

- โ **Passwords ูุดูุฑุฉ** ุจู bcrypt (salt rounds = 10)
- โ **Sessions tokens ุนุดูุงุฆูุฉ** (32 bytes base64)
- โ **Token expiry** = 30 ููู (ูุงุจู ููุชุนุฏูู)
- โ **RLS enabled** ุนูู ุฌููุน ุงูุฌุฏุงูู
- โ **No Email Required** - ููุท username!

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชุญุชุงุฌ** ุฅูู Supabase Auth - ูุธุงููุง ูุณุชูู ุชูุงูุงู
2. **ูุง ุชุญุชุงุฌ** ุฅูู Edge Functions - ูู ุดู ูู PostgreSQL
3. **Sessions ุชูุชูู** ุจุนุฏ 30 ููู (ูููู ุชุนุฏูููุง ูู SQL)
4. **Username ูุฑูุฏ** - ูุง ูููู ุชูุฑุงุฑ ููุณ ุงูุงุณู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ุธูุฑ ุฎุทุฃ "function does not exist":
- ุชุฃูุฏ ุฅูู ูููุฐุช `/supabase-custom-auth-setup.sql` ูุงูู
- ุชุญูู ูู SQL Editor ูู Supabase

### ุฅุฐุง ูุง ุงุดุชุบู Login:
- ุงูุชุญ Console ูุดูู ุงูุฃุฎุทุงุก
- ุชุฃูุฏ ุฅู username ู password ุตุญูุญูู
- ุงูุณุญ localStorage ูุญุงูู ูุฑุฉ ุซุงููุฉ

### ุฅุฐุง Sessions ูุง ุชุดุชุบู ุนูู ุฃุฌูุฒุฉ ุซุงููุฉ:
- ุชุฃูุฏ ุฅู Supabase URL ู Anon Key ุตุญูุญูู ูู `.env`

---

## ๐ ุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉุ ุชุญูู ูู:
1. SQL ุชู ุชูููุฐู ุจูุฌุงุญ
2. localStorage ุชู ูุณุญู
3. Console ููุฃุฎุทุงุก

---

**๐ ุงูุขู ุนูุฏู ูุธุงู authentication ูุงูู ุจุฏูู ุฅูููู!**
